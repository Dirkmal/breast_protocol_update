<div class="patient-report-container">
    <h2>New Report</h2>
    
    <mat-horizontal-stepper [linear]="true" #stepper [selectedIndex]="currentStep">
      <!-- Step 1: Patient Details -->
      <mat-step><!-- [completed]="detailsForm.valid"> -->
        <form [formGroup]="detailsForm">
          <ng-template matStepLabel>Patient Details</ng-template>   

          @for (dc of detail_controls; track dc) {
            <div class="form-row">
              <app-dynamic-form-control [control]="dc" [form]="detailsForm">
              </app-dynamic-form-control>
            </div>
          }
        </form>
        
        <div class="button-row">
          <button mat-raised-button color="primary" (click)="nextStep()">Next</button>
        </div>
      </mat-step>
      
      <!-- Step 2: Macroscopy -->
      <mat-step>
        <form [formGroup]="macroscopyForm">
          <ng-template matStepLabel>Macroscopy</ng-template>   

          <div class="form-section">
            <h3>Specimen Type</h3>
            <div class="checkbox-group">
              @for (st of specimen_type_controls; track st) {
                <app-dynamic-form-control [control]="st" [form]="specimen_typeSF">
                </app-dynamic-form-control>
              }
            </div>
          </div>

          <div class="form-section">
            <h3>Specimen Dimensions (mm)</h3>
            <div class="dimensions-container-4">
              @for (sd of specimen_dimension_controls; track sd) {
                <app-dynamic-form-control [control]="sd" [form]="specimen_dimSF">
                </app-dynamic-form-control>
              }
            </div>
          </div>

          <div class="form-section">
            <h3>Axillary Procedure</h3>
              <div class="checkbox-group">
                @for (ap of axillary_procedure_controls; track ap) {
                  <app-dynamic-form-control [control]="ap" [form]="axillary_proSF">
                  </app-dynamic-form-control>
                }
              </div>
          </div>
        </form>
        
        <div class="button-row">
          <button mat-button (click)="previousStep()">Back</button>
          <button mat-raised-button color="primary" (click)="nextStep()">Next</button>
        </div>
      </mat-step>

      <!-- Step 3: Microscopy -->
      <mat-step>
        <form [formGroup]="microscopyForm">
          <ng-template matStepLabel>Microscopy</ng-template>   

          <div class="form-section">
            <h3>In Situ Carcinoma</h3>
            <div class="dimensions-container-4">
              @for (isc of in_situ_carcinoma_controls; track isc) {
                <app-dynamic-form-control [control]="isc" [form]="in_situSF">
                </app-dynamic-form-control>
              }
            </div>
          </div>

          <div class="form-section">
            <h3>Invasive Carcinoma</h3>
            <div class="dimensions-container-4">
              @for (icc of invasive_carcinoma_controls; track icc) {
                <app-dynamic-form-control [control]="icc" [form]="invasive_carcinomaSF">
                </app-dynamic-form-control>
              }
            </div>
          </div>

          <div class="form-section">
            <h3>Axillary Node</h3>
              <div class="dimensions-container-4">
                @for (ap of axillary_node_controls; track ap) {
                  <app-dynamic-form-control [control]="ap" [form]="axillary_nodeSF">
                  </app-dynamic-form-control>
                }
              </div>
          </div>

          <div class="form-section">
            <h3>Margins</h3>
              <div class="dimensions-container-4">
                @for (mg of margin_controls; track mg) {
                  <app-dynamic-form-control [control]="mg" [form]="marginSF">
                  </app-dynamic-form-control>
                }
              </div>
          </div>

          <div class="form-section">
            <h3></h3>
              <div class="dimensions-container-4">
                @for (smg of surgical_margin_controls; track smg) {
                  <app-dynamic-form-control [control]="smg" [form]="surgical_marginSF">
                  </app-dynamic-form-control>
                }
              </div>
          </div>

          <div class="form-section">
            <h3>Pathological Staging</h3>
              <div class="dimensions-container-4">
                @for (ps of pathological_staging_controls; track ps) {
                  <app-dynamic-form-control [control]="ps" [form]="pathological_stagingSF">
                  </app-dynamic-form-control>
                }
              </div>
          </div>
        </form>
        
        <div class="button-row">
          <button mat-button (click)="previousStep()">Back</button>
          <button mat-raised-button color="primary" (click)="nextStep()">Next</button>
        </div>
      </mat-step>

      <!-- Step 4: Immuno -->
      <mat-step>
        <form [formGroup]="ihcForm">
          <ng-template matStepLabel>Immunohistochemistry</ng-template>   

          @for (ihc of ihc_controls; track ihc) {
            <div class="form-row">
              <app-dynamic-form-control [control]="ihc" [form]="ihcForm">
              </app-dynamic-form-control>
            </div>
          }
        </form>
      
        <div class="button-row">
          <button mat-button (click)="previousStep()">Back</button>
          <button mat-raised-button color="primary" (click)="nextStep()">Next</button>
        </div>
      </mat-step>

      <!-- Step 4: Patho Report -->
      <mat-step>
        <form [formGroup]="pathologistForm">
          <ng-template matStepLabel>Pathologist Report</ng-template>   

          @for (pr of pathologist_report_controls; track pr) {
            <div class="form-row">
              <app-dynamic-form-control [control]="pr" [form]="pathologistForm">
              </app-dynamic-form-control>
            </div>
          }
        </form>
      
        <div class="button-row">
          <button mat-button (click)="previousStep()">Back</button>
          <button mat-raised-button color="primary" (click)="saveReport()">Submit</button>
        </div>
      </mat-step>
    </mat-horizontal-stepper>
  </div>